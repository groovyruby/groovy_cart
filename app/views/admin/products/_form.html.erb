<%= form_for [:admin, @product], :html => { :class => :form, :multipart=>true } do |f| -%>
  <% content_for :head do %>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      <% product_variation = @product.product_variations.new
       %>
      nested_forms['product_variation'] = "<%= generate_template(f, :product_variations, :object=>product_variation) %>";
      nested_forms['photo'] = "<%= generate_template(f, :photos) %>";
    });
  </script>
  <% end %>
  <%= render :partial=>"/admin/shared/form_errors", :locals=>{:f=>f} %>
  <div class="group">
    <%= f.label :name, t("activerecord.attributes.product.name", :default => "Name"), :class => :label %>
    <%= f.text_field :name, :class => 'text_field' %>
    <span class="description"><%= t("groovy_cart.descriptions.product.name") %></span>
  </div>

  <div class="group">
    <%= f.label :sku, t("activerecord.attributes.product.sku", :default => "SKU"), :class => :label %>
    <%= f.text_field :sku, :class => 'text_field' %>
    <span class="description"><%= t("groovy_cart.descriptions.product.sku") %></span>
  </div>

  <div class="group">
    <%= f.label :description, t("activerecord.attributes.product.description", :default => "Description"), :class => :label %>
    <%= f.text_area :description, :class => 'text_area', :size=>"40x10" %>
    <span class="description"><%= t("groovy_cart.descriptions.product.description") %></span>
  </div>

  <div class="group">
    <%= f.label :brand_id, t("activerecord.attributes.product.brand", :default => "Brand"), :class => :label %>
    <%= f.select :brand_id, [['']] | Brand.all.map{|b| [b.name, b.id]}, :class => 'text_field' %>
    <span class="description"><%= t("groovy_cart.descriptions.product.brand") %></span>
  </div>

  <div class="group">
    <%= f.label :price, t("activerecord.attributes.product.price", :default => "Price"), :class => :label %>
    <%= f.text_field :price, :class => 'text_field' %>
    <span class="description"><%= t("groovy_cart.descriptions.product.price") %></span>
  </div>

  <div class="group">
    <%= f.label :price_promo, t("activerecord.attributes.product.price_promo", :default => "Price promo"), :class => :label %>
    <%= f.text_field :price_promo, :class => 'text_field' %>
    <span class="description"><%= t("groovy_cart.descriptions.product.price_promo") %></span>
  </div>

	<div class="group">
    <%= f.label :categories, :class=>"label" %>
    <%= f.select :category_ids, categories_option_tree, {}, {:multiple=>true} %>
  </div>

  <div class="group">
  	<ul id="photos_fields" style="clear: both;">
      <% seq = 0 %>
      <%= f.fields_for :photos do |fpv| %>
        <%= render :partial=>"photo", :locals=>{:f=>fpv, :seq=>seq}%>
        <% seq += 1 %>
      <% end %>
    </ul>
    <a name="photo"></a>
    <%= link_to '+ Add photo', '#photo', :class => "add_nested_item", :rel => "photo" %><br />
  </div>

  <% unless @product.properties.empty? %>
    <div class="group">
      properties
      <ul>
      <%= f.fields_for :properties do |fp| %>
        <%= render :partial=>"property", :locals=>{:f=>fp} %>
      <% end %>
      </ul>
    </div>
  <% end  %>

  <div class="group">
    option groups
    <%= hidden_field_tag 'product[option_group_ids][]' %>
    <ul>
    <% for og in OptionGroup.all %>
      <li><%= check_box_tag 'product[option_group_ids][]', og.id, f.object.option_groups.member?(og) %><label><%= og.name %></label></li>
    <% end %>
    </ul>
  </div>
  
  <% unless @product.option_groups.empty? %>
    <h3>Variations</h3>
    <div class="group">
      <ul id="product_variations_fields" style="clear: both;">
        <% seq = 0 %>
        <%= f.fields_for :product_variations do |fpv| %>
          <%= render :partial=>"product_variation", :locals=>{:f=>fpv, :seq=>seq}%>
          <% seq += 1 %>
        <% end %>
      </ul>
      <a name="product_variation"></a>
      <%= link_to '+ Add product variation', '#product_variation', :class => "add_nested_item", :rel => "product_variation" %><br />
    </div>
  <% end %>

        
  <div class="group navform wat-cf">
    <button class="button" type="submit">
      <%= image_tag("web-app-theme/icons/tick.png", :alt => "#{t("web-app-theme.save", :default => "Save")}") %> <%= t("web-app-theme.save", :default => "Save") %>
    </button>
    <span class="text_button_padding"><%= t("web-app-theme.or", :default => "or") %></span>
    <button class="button" type="submit" name="return" value="1">
      <%= image_tag("web-app-theme/icons/tick.png", :alt => "#{t("web-app-theme.save_and_return", :default => "Save and continue")}") %> <%= t("web-app-theme.save_and_return", :default => "Save and continue editing") %>
    </button>
    <span class="text_button_padding"><%= t("web-app-theme.or", :default => "or") %></span>
    <%= link_to t("web-app-theme.cancel", :default => "Cancel"), admin_products_path, :class => "text_button_padding link_button" %>
  </div>
<% end %>